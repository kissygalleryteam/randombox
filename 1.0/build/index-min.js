/*! randombox - v1.0 - 2013-09-24 9:57:18 AM
* Copyright (c) 2013 伯才; Licensed  */
KISSY.add("gallery/randombox/1.0/index",function(a){function b(c,e){var f=this;return f instanceof b?(f.config=a.mix(d,c),f.list=f.config.list,f.domNum=f.list.length,f.rollTimes=f.config.rollTimes,f.cls=f.config.cls,f.beginIndex=0,f.duration=f.config.duration,f.speedSteps=f.config.speedSteps,f._init(),f.callback="function"==typeof e?e:void 0,void 0):new b}var c=a.all;a.Event;var d={rollTimes:4,cls:"sel-item",duration:40,speedSteps:[1,2,5]};return a.augment(b,{_init:function(){var a=this,b=a.domNum;a.$domList=[],a.curRollTimes=0;for(var d=0;b>d;d++)a.$domList[d]=c(a.list[d]);a.changeTimes=b*a.rollTimes,a.config.finalId?(a.finalId=a.config.finalId,a.finalNum=a.changeTimes+a.indexOfArray(a.list,a.finalId)+1):(a.finalNum=a.getRandomNum(a.changeTimes,a.changeTimes+b),a.finalId=a.list[a.finalNum%b])},rolling:function(){var a=this;a.choose(a.$domList[a.beginIndex%a.domNum]),a.beginIndex+=1,a.start(),a.beginIndex==a.finalNum&&(a._clearInterval(),a.callback(a.curTarget))},_setInterval:function(a){var b=this;b.interval=setInterval(function(){b.rolling()},a)},_clearInterval:function(){var a=this;clearInterval(a.interval)},start:function(){var a=this,b=a.duration,c=a.speedSteps;a.stop(),a.beginIndex<a.finalNum&&(a.beginIndex>a.finalNum-10?a._setInterval(b*c[2]):a.beginIndex<=a.finalNum-10&&a.beginIndex>=a.finalNum-20?a._setInterval(b*c[1]):a._setInterval(b*c[0]))},stop:function(){var a=this;a._clearInterval()},reset:function(){var a=this,b=a.$domList,c=a.domNum,d=a.cls;a.stop(),a.beginIndex=0,a._init();for(var e=0,f=c;f>e;e++)b[e].hasClass(d)?b[e].removeClass(d):null},choose:function(b){var c=this;a.each(c.$domList,function(a){a.removeClass(c.cls)}),b.addClass(c.cls),c.curTarget="#"+b.attr("id")||""},getRandomNum:function(a,b){return a?b?parseInt(Math.random()*(b-a)+a):parseInt(Math.random()*a):0},indexOfArray:function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]==b)return c;return-1}}),a.RandomBox=b,b},{requires:["node","ajax"]});